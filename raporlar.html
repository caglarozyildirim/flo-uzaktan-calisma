<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raporlar - FLOConnect</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        .filters-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .export-buttons {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .btn-export {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-export-excel {
            background: #1D6F42;
            color: white;
        }

        .btn-export-excel:hover {
            background: #155733;
        }

        .btn-export-pdf {
            background: #D32F2F;
            color: white;
        }

        .btn-export-pdf:hover {
            background: #B71C1C;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: linear-gradient(135deg, #F8F9FA 0%, #FFFFFF 100%);
            border: 2px solid #E0E0E0;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .stat-icon {
            font-size: 48px;
        }

        .stat-content {
            flex: 1;
        }

        .stat-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-burgundy);
        }

        .report-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .report-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .report-table thead {
            background: linear-gradient(135deg, #8B4367 0%, #9F5577 100%);
            color: white;
        }

        .report-table th {
            padding: 14px 12px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .report-table td {
            padding: 14px 12px;
            border-bottom: 1px solid #F0F0F0;
            font-size: 13px;
        }

        .report-table tbody tr:hover {
            background: #FFF5F0;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-city-local {
            background: #E3F2FD;
            color: #1976D2;
        }

        .badge-city-external {
            background: #FFF3E0;
            color: #F57C00;
        }

        .badge-international {
            background: #F3E5F5;
            color: #7B1FA2;
        }

        .badge-approved {
            background: #E8F5E9;
            color: #4CAF50;
        }

        .badge-pending {
            background: #FFF3E0;
            color: #E67E50;
        }

        .badge-rejected {
            background: #FFEBEE;
            color: #F44336;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .access-denied {
            text-align: center;
            padding: 80px 20px;
            background: white;
            border-radius: 12px;
            margin-top: 40px;
        }

        .access-denied-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">FLO<span style="font-weight: 300;">Connect</span></div>
        <button class="notification-btn">
            üîî Bildirimler
        </button>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="user-profile">
                <div class="user-avatar">YA</div>
                <div class="user-name">Yasin Atalay</div>
                <div class="user-title">ƒ∞nsan Kaynaklarƒ± M√ºd√ºr√º</div>
                <div class="user-role">Raporlama Yetkili</div>
            </div>

            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link has-submenu">
                            <span class="nav-icon">üìä</span>
                            QR Giri≈ü - √áƒ±kƒ±≈ü
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link has-submenu">
                            <span class="nav-icon">üèñÔ∏è</span>
                            ƒ∞zin Mod√ºl√º
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link has-submenu">
                            <span class="nav-icon">‚úàÔ∏è</span>
                            Seyahat Mod√ºl√º
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link has-submenu">
                            <span class="nav-icon">üíº</span>
                            Ofis Dƒ±≈üƒ± √áalƒ±≈üma
                        </a>
                    </li>
                    <li class="nav-item active">
                        <a href="raporlar.html" class="nav-link">
                            <span class="nav-icon">üìà</span>
                            Raporlar
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            Ayarlar
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Breadcrumb -->
            <div class="breadcrumb">
                <a href="dashboard.html">Ana Sayfa</a>
                <span class="separator">‚Ä∫</span>
                <span>Raporlar</span>
            </div>

            <!-- Page Header -->
            <div style="margin-bottom: 24px;">
                <h1 style="font-size: 28px; color: var(--primary-burgundy); margin-bottom: 8px;">Ofis Dƒ±≈üƒ± √áalƒ±≈üma Raporlarƒ±</h1>
                <p style="color: #666; font-size: 14px;">T√ºm ofis dƒ±≈üƒ± √ßalƒ±≈üma taleplerini g√∂r√ºnt√ºleyin ve raporlayƒ±n.</p>
            </div>

            <div id="contentContainer"></div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/tr.js"></script>

    <script>
        // Authorized users list
        const authorizedUsers = [
            'yasin.atalay@flo.com.tr',
            'seren.demir@flo.com.tr',
            'meltem.evci@flo.com.tr',
            'recep.kefeli@flo.com.tr',
            'nihan.kural@flo.com.tr',
            'bersan.oter@flo.com.tr',
            'zeynep.sahin@flo.com.tr',
            'sinem.ertekin@flo.com.tr',
            'mujgan.uslu@flo.com.tr'
        ];

        // Current user (for demo purposes)
        const currentUser = {
            name: 'Yasin Atalay',
            email: 'yasin.atalay@flo.com.tr'
        };

        // Check access
        if (!authorizedUsers.includes(currentUser.email)) {
            document.getElementById('contentContainer').innerHTML = `
                <div class="access-denied">
                    <div class="access-denied-icon">üîí</div>
                    <h2>Eri≈üim Yetkiniz Bulunmamaktadƒ±r</h2>
                    <p>Bu sayfaya eri≈üim i√ßin yetkiniz bulunmamaktadƒ±r. L√ºtfen sistem y√∂neticisi ile ileti≈üime ge√ßiniz.</p>
                </div>
            `;
        } else {
            renderReportPage();
        }

        function renderReportPage() {
            const contentContainer = document.getElementById('contentContainer');

            contentContainer.innerHTML = `
                <!-- Filters Card -->
                <div class="filters-card">
                    <h3 style="margin-bottom: 16px; color: var(--primary-burgundy);">Filtreler</h3>

                    <div class="filter-row">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Ba≈ülangƒ±√ß Tarihi</label>
                            <input type="text" id="filterStartDate" class="form-input" placeholder="Tarih se√ßiniz">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Biti≈ü Tarihi</label>
                            <input type="text" id="filterEndDate" class="form-input" placeholder="Tarih se√ßiniz">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">√áalƒ±≈üma Lokasyonu</label>
                            <select id="filterLocation" class="form-input">
                                <option value="">T√ºm√º</option>
                                <option value="city-local">≈ûehir ƒ∞√ßi</option>
                                <option value="city-external">≈ûehir Dƒ±≈üƒ±</option>
                                <option value="international">Yurt Dƒ±≈üƒ±</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Durum</label>
                            <select id="filterStatus" class="form-input">
                                <option value="">T√ºm√º</option>
                                <option value="pending">Bekliyor</option>
                                <option value="approved">Onaylandƒ±</option>
                                <option value="rejected">Reddedildi</option>
                            </select>
                        </div>
                    </div>

                    <div class="filter-row">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Birim - Direkt√∂rl√ºk</label>
                            <input type="text" id="filterBirim" class="form-input" placeholder="Birim ara...">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Grup Adƒ± - GMY'lik</label>
                            <input type="text" id="filterGrup" class="form-input" placeholder="Grup ara...">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">√áalƒ±≈üan Ara</label>
                            <input type="text" id="filterEmployee" class="form-input" placeholder="ƒ∞sim veya sicil...">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label" style="visibility: hidden;">Action</label>
                            <button class="btn btn-primary" onclick="applyFilters()" style="width: 100%;">Filtrele</button>
                        </div>
                    </div>

                    <div class="export-buttons">
                        <button class="btn-export btn-export-excel" onclick="exportToExcel()">
                            üìä Excel'e Aktar
                        </button>
                        <button class="btn-export btn-export-pdf" onclick="exportToPDF()">
                            üìÑ PDF'e Aktar
                        </button>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="stats-grid" id="statsGrid"></div>

                <!-- Report Table -->
                <div class="report-table" id="reportTableContainer"></div>
            `;

            // Initialize date pickers
            flatpickr("#filterStartDate", {
                locale: "tr",
                dateFormat: "d.m.Y"
            });

            flatpickr("#filterEndDate", {
                locale: "tr",
                dateFormat: "d.m.Y"
            });

            // Load and display report
            loadReport();
        }

        function loadReport() {
            const requests = JSON.parse(localStorage.getItem('remoteworkRequests') || '[]');

            // Calculate statistics
            const stats = {
                total: requests.length,
                pending: requests.filter(r => r.status === 'pending').length,
                approved: requests.filter(r => r.status === 'approved').length,
                rejected: requests.filter(r => r.status === 'rejected').length
            };

            displayStats(stats);
            displayReportTable(requests);
        }

        function displayStats(stats) {
            const statsGrid = document.getElementById('statsGrid');

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-content">
                        <div class="stat-label">Toplam Talep</div>
                        <div class="stat-value">${stats.total}</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚è≥</div>
                    <div class="stat-content">
                        <div class="stat-label">Bekleyen</div>
                        <div class="stat-value">${stats.pending}</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-content">
                        <div class="stat-label">Onaylanan</div>
                        <div class="stat-value">${stats.approved}</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ùå</div>
                    <div class="stat-content">
                        <div class="stat-label">Reddedilen</div>
                        <div class="stat-value">${stats.rejected}</div>
                    </div>
                </div>
            `;
        }

        function displayReportTable(requests) {
            const container = document.getElementById('reportTableContainer');

            if (requests.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <h3>Kayƒ±t Bulunamadƒ±</h3>
                        <p>Hen√ºz hi√ß talep kaydƒ± bulunmamaktadƒ±r.</p>
                    </div>
                `;
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Sicil</th>
                            <th>√áalƒ±≈üan</th>
                            <th>Pozisyon</th>
                            <th>ƒ∞≈üe Giri≈ü</th>
                            <th>Birim</th>
                            <th>Grup Adƒ±</th>
                            <th>Y√∂netici</th>
                            <th>Lokasyon</th>
                            <th>Tarih Aralƒ±ƒüƒ±</th>
                            <th>G√ºn</th>
                            <th>Durum</th>
                            <th>Talep Tarihi</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            requests.forEach(request => {
                html += `
                    <tr>
                        <td><strong>${request.userSicil}</strong></td>
                        <td>${request.userName}</td>
                        <td>${request.position}</td>
                        <td>${new Date(request.hireDate).toLocaleDateString('tr-TR')}</td>
                        <td>${request.birim}</td>
                        <td>${request.grupAdi}</td>
                        <td>${request.manager}</td>
                        <td>${getLocationBadge(request.workLocation, request.workLocationText)}</td>
                        <td style="white-space: nowrap;">
                            ${new Date(request.startDate).toLocaleDateString('tr-TR')} -
                            ${new Date(request.endDate).toLocaleDateString('tr-TR')}
                        </td>
                        <td><strong>${request.totalDays}</strong></td>
                        <td>${getStatusBadge(request.status)}</td>
                        <td>${new Date(request.createdAt).toLocaleDateString('tr-TR')}</td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
            `;

            container.innerHTML = html;
        }

        function getLocationBadge(type, text) {
            const badges = {
                'city-local': `<span class="badge badge-city-local">${text}</span>`,
                'city-external': `<span class="badge badge-city-external">${text}</span>`,
                'international': `<span class="badge badge-international">${text}</span>`
            };
            return badges[type] || text;
        }

        function getStatusBadge(status) {
            const badges = {
                'pending': '<span class="badge badge-pending">Bekliyor</span>',
                'approved': '<span class="badge badge-approved">Onaylandƒ±</span>',
                'rejected': '<span class="badge badge-rejected">Reddedildi</span>'
            };
            return badges[status] || badges['pending'];
        }

        function applyFilters() {
            let requests = JSON.parse(localStorage.getItem('remoteworkRequests') || '[]');

            // Apply location filter
            const locationFilter = document.getElementById('filterLocation').value;
            if (locationFilter) {
                requests = requests.filter(r => r.workLocation === locationFilter);
            }

            // Apply status filter
            const statusFilter = document.getElementById('filterStatus').value;
            if (statusFilter) {
                requests = requests.filter(r => r.status === statusFilter);
            }

            // Apply birim filter
            const birimFilter = document.getElementById('filterBirim').value.toLowerCase();
            if (birimFilter) {
                requests = requests.filter(r => r.birim.toLowerCase().includes(birimFilter));
            }

            // Apply grup filter
            const grupFilter = document.getElementById('filterGrup').value.toLowerCase();
            if (grupFilter) {
                requests = requests.filter(r => r.grupAdi.toLowerCase().includes(grupFilter));
            }

            // Apply employee filter
            const employeeFilter = document.getElementById('filterEmployee').value.toLowerCase();
            if (employeeFilter) {
                requests = requests.filter(r =>
                    r.userName.toLowerCase().includes(employeeFilter) ||
                    r.userSicil.toLowerCase().includes(employeeFilter)
                );
            }

            // Calculate filtered stats
            const stats = {
                total: requests.length,
                pending: requests.filter(r => r.status === 'pending').length,
                approved: requests.filter(r => r.status === 'approved').length,
                rejected: requests.filter(r => r.status === 'rejected').length
            };

            displayStats(stats);
            displayReportTable(requests);
        }

        function exportToExcel() {
            alert('Excel export √∂zelliƒüi yakƒ±nda eklenecektir.');
        }

        function exportToPDF() {
            alert('PDF export √∂zelliƒüi yakƒ±nda eklenecektir.');
        }
    </script>
</body>
</html>
